\documentclass[a4paper,12pt,twoside]{article}

\usepackage[MeX]{polski}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{graphicx}
\usepackage{color}
\usepackage{url}
\usepackage{tocbibind}
\usepackage[]{units}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{longtable}
\usepackage{bbm}
\usepackage{listings}
\usepackage{lmodern}
\usepackage{tabu}
\usepackage{tikz}
\usepackage[htt]{hyphenat}
\usepackage{todonotes}
%\usepackage{hyperref}
\usepackage{titlesec}
\usepackage{mathtools}
\usepackage{cite}
\linespread{1.5}

% marginesy, szerokość i wysokość tekstu-
\setlength\topmargin{-0.25in}
\setlength\textheight{9in}
\setlength\headsep{0.2in}
\setlength\footskip{0.5in}
\setlength\oddsidemargin{0.4in}
\setlength\evensidemargin{0in}
\setlength\textwidth{5.8in}
\setlength\headheight{15.3pt}
\setlength\fboxsep{0pt}

% definicje nagłówków
%\usepackage{fancyhdr}
\pagestyle{plain}
%\renewcommand{\chaptermark}[1]{
%	\markboth{\MakeUppercase{
%			\chaptername\ \thechapter.
%			\ #1}}{}}
\newcommand{\Z}{\mathbbm{Z}}
\newcommand{\e}{\varepsilon}
\newcommand{\diam}{\operatorname{diam}}
%\fancypagestyle{plain}{ % styl: tylko numery stron
%	\fancyhf{}
%	\fancyfoot[C]{\thepage} % stopka: numer strony pośrodku
%	\renewcommand{\headrulewidth}{0pt}
%	\renewcommand{\footrulewidth}{0pt}}

%\fancypagestyle{headings}{% styl: numery stron i nagłówki
%	\fancyhf{}
%	\fancyhead[RO,LE]{\leftmark} % nagłówek prawo na nieparzystych, lewo na parzystych:
	% nazwa rozdziału
%	\fancyfoot[C]{\thepage} % stopka: numer strony pośrodku
%	\renewcommand{\headrulewidth}{0.3pt}
%	\renewcommand{\footrulewidth}{0pt}}
\newcommand{\N}{\mathbbm{N}}
\newcommand{\Q}{\mathbbm{Q}}
\newcommand{\R}{\mathbbm{R}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\card}{\operatorname{card}}
\usepackage{etoolbox}
\newcommand{\dd}{\delta}
\makeatletter
%\patchcmd{\epigraph}{\@epitext{#1}}{\itshape\@epitext{#1}}{}{}
\makeatother
\newcommand{\U}{\mathcal{U}}
% Zawartość
\newcommand{\B}{\mathcal{B}}
\theoremstyle{plain}
	\newtheorem{tw}{Twiedzenie}
	\newtheorem{lem}{Lemat}
\theoremstyle{definition}
	\newtheorem{defi}{Definicja}
	\newtheorem{ex}{Przykład}
\theoremstyle{remark}
	\newtheorem{obs}{Obserwacja}
	\newtheorem{remark}{Uwaga}
	\newtheorem{wniosek}{Wniosek}
	\newcommand\smallc{
		\mathchoice
		{{\scriptstyle\mathcal{C}}}% \displaystyle
		{{\scriptstyle\mathcal{C}}}% \textstyle
		{{\scriptscriptstyle\mathcal{C}}}% \scriptstyle
		{\scalebox{.7}{$\scriptscriptstyle\mathcal{C}$}}%\scriptscriptstyle
	}
\begin{document}
\begin{titlepage}
	\begin{flushleft}
	\end{flushleft}
	\begin{center}
		\textsc{{\huge Politechnika \L\'odzka}}
	\end{center}
	\bigskip
	\bigskip
	\begin{center}
		\textsc{{\Large Wydzia\l\ Fizyki Technicznej, Informatyki i~Matematyki Stosowanej}}
	\end{center}
	\bigskip
	\bigskip
	%\begin{center}
	\begin{Large}
		Kierunek: Informatyka\\   
		Przedmiot: Systemy wbudowane %TU WPISZ SPECJALNOŚĆ% 
	\end{Large}
	%\end{center}
	\bigskip
	\bigskip
	\bigskip
	\bigskip
	\begin{center}
		\textsc{\textbf{{\Large Dokumentacja gry zręcznościowej Procesja$^{\textrm{TM}}$ %TU WPISZ TYTUŁ PRACY%
					\\
					LPC1343 + Expansion Board
					}}}
	\end{center}
	\bigskip
	\bigskip
	\begin{flushright}
		{\large 
			lider: mgr Filip Turoboś %TU WPISZ SWOJE IMIĘ I NAZWISKO%
			\\
			Nr albumu: 
			210344 / 801147 %TU WPISZ SWÓJ NUMER ALBUMU%
			\\
			Jan Filipowicz %TU WPISZ SWOJE IMIĘ I NAZWISKO%
			\\
			Nr albumu: 
			203875 %TU WPISZ SWÓJ NUMER ALBUMU%
			\\
			Krzysztof Wierzbicki %TU WPISZ SWOJE IMIĘ I NAZWISKO%
			\\
			Nr albumu: 
			210347 %TU WPISZ SWÓJ NUMER ALBUMU%
			\\
		}
	\end{flushright}
	\noindent\hrulefill
		\begin{center}
		{\textsc{\large \L\'od\'z, \date{Listopad 2017} %TU WPISZ  MIESIĄC I ROK ODDANIA PRACY%
			}}
		\end{center}
	\end{titlepage}	
% !TeX spellcheck = pl_PL
%\begin{titlepage}
%
%\begin{minipage}{0.19\textwidth}
%\begin{flushleft}
%\includegraphics[width=0.88\textwidth]{img/logo}
%\end{flushleft}
%\end{minipage}
%\begin{minipage}[t][][t]{0.81\textwidth}
%\begin{flushleft}
%\vspace{-2\baselineskip}
%\textbf{{\large Politechnika Łódzka}\\}
%\vspace{\medskipamount}
%\textbf{\large Wydział Fizyki Technicznej, Informatyki\\i~Matematyki Stosowanej}
%\vspace{\medskipamount}\\ %oo
%{\large Instytut Matematyki}\\
%\end{flushleft}
%\end{minipage}
%\vspace{2.5cm}
%
%\begin{center}
%{\Large {Filip Turoboś, 206799\\}}
%\vspace{2cm}
%{\huge{ {Przestrzenie wyposażone\\ w funkcje typu odległości}}}
%\end{center}
%\vspace{3cm}
%\hfill
%\begin{minipage}{.65\columnwidth}
%Praca {magisterska}\\
%Promotor: prof. dr hab. inż. Jacek Jachymski
%\end{minipage}
%\vfill
%\begin{center}
%Łódź {2017}
%\end{center}
%\end{titlepage}
\tableofcontents
\newpage
\section{Podsumowanie i technikalia}
\subsection{Skład zespołu}
$\begin{array}{|l|l|l|}
	\hline
	\textrm{Funkcja:}& \textrm{Imię i nazwisko: }& \textrm{Nr albumu: }\\
	\hline
	\textrm{lider}& \textrm{Filip Turoboś}&\textrm{ 210344, 801147}\\
	\hline
	\textrm{członek}&\textrm{Jan Filipowicz}&\textrm{	203875 	}\\
	\hline
	\textrm{członek}&\textrm{Krzysztof Wierzbicki}& \textrm{210347}\\
	\hline
\end{array}$
	% do poprawy
\subsection{Sprzęt}
Na potrzeby projektu nie wykonywano żadnego własnego sprzętu.
Do projektu wykorzystano LPC1343 i Expansion Board.
\subsection{Wykorzystane funkcjonalności i ich autorzy}
%\subsubsection{MCU}

%\subsubsection{Urządzenia peryferyjne}
\begin{itemize}
	\item Timer
	\item GPIO
	\item ADC
	\item SPI/SSP
	\item I$^2$C
	\item Wyświetlacz siedmiosegmentowy
	\item Wyświetlacz LCD
	\item Przerwania
	\item DAC
	\item Akcelerometr
\end{itemize}
\subsubsection{Dokumentacja}
Opis poszczególnych funkcjonalności: Filip Turoboś

Skład i opracowanie całości dokumentu: Filip Turoboś

\subsubsection{Procentowy udział poszczególnych członków zespołu w tworzeniu końcowej wersji projektu}
$\begin{array}{|l|l|l|}
\hline
\textrm{Imię i nazwisko: }& \textrm{Procentowy udział: }\\
\hline
 \textrm{Filip Turoboś}&\textrm{ 30\%}\\
\hline
\textrm{Jan Filipowicz}&\textrm{	38\% 	}\\
\hline
\textrm{Krzysztof Wierzbicki}& \textrm{32\%}\\
\hline
\end{array}$
\newpage
\section{Skrótowy opis działania programu}
Podczas gry w Procesja$^{\textrm{TM}}$ gracz manewruje przy pomocy joysticka i/lub akcelerometru białą łamaną symbolizującą procesję i stara się poruszać nią w taki sposób, aby:
\begin{itemize}
	\item nie przecinać tworzonej przez siebie łamanej; 
	\item zbierać pojawiające się na planszy kropki symbolizujące zbłąkane owieczki.
\end{itemize}

W przypadku gdy gracz najedzie łamaną na pulsującą kropkę, całość procesji zostaje przedłużona. Radując się z ilości zgromadzonych wiernych możemy odgrywać pieśń sakralną \textit{"Barka"} autorstwa Jana Pawła II.

\section{Algorytm gry}

\section{Funkcjonalności}
\subsection{Timer}
Układ, który dekrementuje lub inkrementuje wartość jednego ze swoich rejestrów w zależności od częstotliwości otrzymywanego sygnału nazywamy \textbf{timerem}. Każdy timer jest wyposażony w dwa podstawowe rejestry -- licznik timera i rejestr kontroli timera. W przypadku płytki LPC 1343 timer jest dodatkowo wyposażony w preskaler. Zwiększenie licznika timera $(TC)$ -- \textit{timer counter} następuje po spełnieniu następujących warunków:
\begin{itemize}
\item Wartość rejestru preskalera $(PR)$ jest ustawiona na pewną wartość $K\in \N_0$ -- domyślnie $K=0$;
\item 32-bitowy licznik preskalera $(PC)$ osiągnie wartość $K+1$;
\end{itemize}
Po inkrementacji $(TC)$ następuje wyzerowanie licznika preskalera.
\subsection{GPIO}
Skrót $(GPIO)$ oznacza \textit{General purpose input/output}, czyli \textbf{interfejs wejścia /wyjścia ogólnego przeznaczenia}. Przy pomocy $(GPIO)$ obsługiwany jest joystick, w który wyposażona jest płytka. Służy on do poruszania się instancją obiektu typu wąż, umożliwiając tym samym granie w grę.

Aby używać joysticka musimy najpierw ustalić rolę odpowiednich pinów na \textit{INPUT}. W naszym przypadku stosowane jest port nr 2 i piny od $1$ do $4$, odpowiadających za poszczególne kierunki (odpowiednio dół/prawo/góra/lewo). 

Posuszanie wężem polega na sprawdzaniu stanów poszczególnych pinów. Przykładowo, gdy ostatnio odczytany stan wysoki wystąpił na pinie nr 2, nasz wąż zacznie poruszać się w prawo (o ile jest to możliwe, tj. nie poruszał się uprzednio w lewo). Jeżeli nie jest odczytywany obecnie stan wysoki na żadnym z pinów, to wąż kontynuuje poruszanie się w ostatnio wybranym kierunku. W przypadku, gdy odczytany ruch jest przeciwny do obecnego, sygnał odebrany z $(GPIO)$ zostanie zignorowany.

\subsection{ADC}
\textit{Analog-Digital Converter}, czyli
\textbf{Konwerter analogowo-cyfrowy} $(ADC)$ jest przetwornikiem pozwalającym na zmianę zewnętrznego sygnału analogowego (w naszym przypadku napięcia) na ciąg $10$ bitów. $ADC$ na stosowanym przez nas mikrokontrolerze używa algorytmu sukcesywnej aproksymacji, którego krótki opis załączony zostanie w podrozdziale \textbf{Algorytm sukcesywnej aproksymacji w $ADC$}.

Przy pomocy $ADC$ gracz jest w stanie kontrolować prędkość poruszanej przez siebie procesji. Precyzyjnie, jeden krok procesji zajmuje
\[
\operatorname{new\_snek\_speed} =\left( \left\lfloor \frac{4000}{ \operatorname{ADCread}(0)} \right\rfloor + 20 \right) \; ms.
\]
Do odczytu wartości z ADC stosowana jest funkcja \textit{ADCread(0)}, która odczytuje wartość napięcia na zerowym pinie.
Odczytywane przez nas wartości z $ADC$ są liczbami całkowitymi z przedziału $[39;1023]$. Dzięki temu nigdy nie dochodzi do dzielenia przez zerową wartość. Funkcja odczytująca wartość wywoływana jest przy każdym obrocie głównej pętli programu. Dzięki temu wartość prędkość procesji jest dostosowywana na bieżąco do aktualnego napięcia na zerowym pinie $ADC$, które kontroluje użytkownik przy pomocy pokrętła A22K. Zgodnie z \cite{INST} napięcie to mieści się w zakresie od $0$ do $3.6 \;V$. 
Inicjalizacja konwertera analogowo-cyfrowego przebiega w następujący sposób:
\begin{enumerate}
	\item Zerujemy bit odpowiadający za odłączenie od zasilania bloku konwertera:
		\begin{verbatim}
		  LPC_SYSCON->PDRUNCFG &= ~(0x1<<4);
		\end{verbatim}
	\item Uruchamiamy zegar AHB dla bloku ADC
		\begin{verbatim}
		  LPC_SYSCON->SYSAHBCLKCTRL |= (1<<13);
		\end{verbatim}
	\item ...nie rozumiem.
\end{enumerate}

	\subsubsection{Algorytm sukcesywnej aproksymacji $ADC$ \cite{ADCINST}}
	Algorytm sukcesywnej aproksymacji jest w istocie sprzętową wersją przeszukiwania binarnego. Rejestr SAR (\textit{Successive Approximation Register}), do którego zapisywana bedzie odczytana z konwertera wartość jest pierwotnie zainicjalizowany samymi zerami, zaś najbardziej znaczący bit jest przestawiany na wartość $1$. Następnie wartość rejestru jest konwertowana na sygnał analogowy, po czym komparator porównuje napięcie wejściowe z konwertera z napięciem odpowiadającym ciągowi bitów z rejestru SAR. Jeżeli napięcie wejściowe w konwerterze (czyli sygnał otrzymywany dzięki ustawieniu pokrętła na odpowiedniej pozycji) przekracza wartość napięcia wygenerowanego na podstawie rejestru -- bit wiodący pozostaje w stanie $1$, w przeciwnym razie przypisana zostaje mu wartość $0$. Następnie analogiczne postępowanie zostaje przeprowadzane dla sukcesywnego bitu. Procedura powtarzana jest dziesięciokrotnie, do zapełnienia całego rejestru.

\subsection{SPI/SSP}
\textit{Serial Peripheral Interface / Synchronous Serial Port}, interfejs ten jest używany, by komunikować się z wyświetlaczami. Jak wskazuje nazwa, komunikacja przebiega synchronicznie poprzez trzy równoległe linie. Są nimi
\begin{itemize}
	\item $MOSI$ - \textit{Master Input Slave Output} pozwala na wysyłanie danych do zewnętrznego układu (w naszym wypadku wyświetlaczy);
	\item $MISO$ - \textit{Master Output Slave Input} służy do pobierania danych z układu zewnętrznego;
	\item $SCLK$ - \textit{Serial CLocK} zegar taktujący -- precyzyjniej sygnał zegarowy.
\end{itemize}

\subsection{I$^2$C}

\subsection{Wyświetlacz siedmiosegmentowy}
W zaprojektowanej grze wyświetlacz siedmiosegmentowy służy jako element dekoracyjny i nie ma wpływu na rozgrywkę. Przez cały czas trwania rozgrywki wyświetla on kolejne litery napisu.

1. Inicjalizacja wyświetlacza siedmiosegmentowego polega na ustawieniu kierunku w pierwszym porcie GPIO. Na 11 bicie ustawiana jest wartość 1, co oznacza kierunek wyjściowy
\begin{verbatim}
		LPC_GPIO1->DIR |= (0x1<<11);
\end{verbatim}
a następnie ustawienie na tym bicie wartości 1, przy czym tak zainicjalizowany wyświetlacz nie wyświetla jeszcze żadnego znaku.
\begin{verbatim}
 GPIOShadowPort1 |= (1<<11);
\end{verbatim}

2. Deklarujemy wartość zmiennej letters\_speed, która opisywać będzie co ile iteracji głównej pętli programu nastąpi zmiana wyświetlanego znaku (poprzedzona jednoiteracyjną przerwą):
\begin{verbatim}
const uint8_t letters_speed = 10;
\end{verbatim}
Tablica znaków do wyświetlania przez wyświetlacz siedmiosegmentowy ma następującą deklarację:
\begin{verbatim}
const uint8_t letters[] = "NO STEP ON SNECC ";
\end{verbatim}

3. W pojedynczej iteracji głównej pętli programu wykonujemy następujące kroki:

$\quad$ 3.1 Upewniamy się, że zmienna kontrolująca wartość wyświetlanej litery letters\_state nie przekroczy wartości \textbf{sizeof}(letters)$\cdot$letters\_speed.
\begin{verbatim}
letters_state %= letters_size * letters_speed;
\end{verbatim}

$\quad$ 3.2 Wybieramy instrukcją warunkową czy obecnie wyświetlany jest znak z tablicy letters, czy też następuje przerwa, która czyni napis czytelniejszym dla użytkownika. Zestaw stosowanych w programie znaków pozwala wyświetlić każdy z nich na wyświetlaczu siedmiosegmentowym. Zero przekazywane jako drugi argument funkcji sprawia, że nie wchodzimy w tryb surowego przesyłu danych (tryb w którym korzystamy z funkcji led7seg\_setChar sprawia, że litery odczytywane są jako znaki ASCII):
\begin{verbatim}
led7seg_setChar(letters_state % letters_speed ?
letters[letters_state / letters_speed] : ' ', FALSE);
\end{verbatim}
Funkcja ta przy pomocy metody SSPSend przekazuje stablicowane ośmiobitowe wartości całkowite odpowiadające poszczególnym wyświetlanym znakom. Przykładowo, wartością odpowiadającą literze '\textbf{S}' jest 0x12. Przed przesłaniem przez SSP jakichkolwiek danych musimy jednak zmienić wartość jedenastego bitu pierwszego portu GPIO na 0. 
\begin{verbatim}
GPIOShadowPort1 &= ~(1<<bitPosi);
\end{verbatim}
Po zakończeniu przesyłania zmiennej zostaje on ponownie przywrócony do stanu 1 tak samo jak przy inicjalizacji.

$\quad$ 3.3 Zwiększamy wartość letters\_state o jeden.
\begin{verbatim}
letters_state++;
\end{verbatim}
\subsection{Wyświetlacz LCD}

\subsection{Przerwania (Interrupts)}

\subsection{DAC (Melodia)}

\subsection{Akcelerometr}



\section{Analiza FMEA}

\begin{center}
	\begin{tabular}{|c|c|c|c|}\hline
		Możliwa awaria & Prawdopodobieństwo & Reakcja & Istotność\\ \hline\hline % <-- note that two \hlines produce a double line
		Uszkodzenie wyświetlacza LCD & mrg@duke.edu& xD & Krytyczna \\ \hline
		Uszkodzenie joysticka & mje7@duke.edu &Xd & Wysoka \\ \hline
		Uszkodzenie akcelerometru & mje7@duke.edu &Xd & \'Srednia \\ \hline
		Uszkodzenie wyświetlacza 7segmentowego & xD &XD & Znikoma \\ \hline
	\end{tabular}
\end{center}
	\subsection{Uszkodzenie wyświetlacza LCD}
		\subsubsection{Rozpoznanie}
		\subsubsection{Reakcja}
	\subsection{Uszkodzenie joysticka}
		\subsubsection{Rozpoznanie}
		\subsubsection{Reakcja}
	\subsection{Uszkodzenie akcelerometru}
	\subsubsection{Rozpoznanie}
	\subsubsection{Reakcja}
	\subsection{Uszkodzenie wyświetlacza 7segmentowego}
	\subsubsection{Rozpoznanie}
	\subsubsection{Reakcja}
\section{Wykorzystane noty katalogowe, dokumentacja i literatura}
		
		\bibliographystyle{plain}
\begin{thebibliography}{abcd}
\bibitem{INST}{
	\textit{UM10375 LPC1311/13/42/43 User manual},
	{21 June 2012},
	\textbf{Rev. 5},
}		
\bibitem{ADCINST}{
\textit{Understanding SAR ADCs: Their Architecture and Comparison with Other ADCs},
	{02 October 2001},
	\textbf{Maxim Integrated Products, Inc.}	
}
\bibitem{ADCtut}
{LPC1343 ADC programming tutorial},
	{18 November 2017},
	\textbf{Umang Gajera}
\end{thebibliography}

\end{document}



		%Charakteryzacja metryczności przez kulę otwartą.